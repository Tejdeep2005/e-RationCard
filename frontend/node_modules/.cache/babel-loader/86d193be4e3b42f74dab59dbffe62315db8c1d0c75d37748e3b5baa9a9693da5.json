{"ast":null,"code":"import{useState,useEffect}from\"react\";import\"@/App.css\";import{BrowserRouter,Routes,Route,Navigate}from\"react-router-dom\";import axios from\"axios\";import Landing from\"./pages/Landing\";import UserDashboard from\"./pages/UserDashboard\";import AdminDashboard from\"./pages/AdminDashboard\";import{Toaster}from\"sonner\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const BACKEND_URL=process.env.REACT_APP_BACKEND_URL;export const API=\"\".concat(BACKEND_URL,\"/api\");function App(){const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);useEffect(()=>{// Check for existing token\nconst token=localStorage.getItem(\"token\");if(token){axios.defaults.headers.common[\"Authorization\"]=\"Bearer \".concat(token);fetchUser();}else{setLoading(false);}// Check for Google OAuth session_id in URL\nconst hash=window.location.hash;if(hash.includes(\"session_id\")){const sessionId=hash.split(\"session_id=\")[1];processGoogleSession(sessionId);}},[]);const fetchUser=async()=>{try{const response=await axios.get(\"\".concat(API,\"/auth/me\"));setUser(response.data);}catch(error){localStorage.removeItem(\"token\");delete axios.defaults.headers.common[\"Authorization\"];}finally{setLoading(false);}};const processGoogleSession=async sessionId=>{setLoading(true);try{const response=await axios.post(\"\".concat(API,\"/auth/google-session\"),{session_id:sessionId});localStorage.setItem(\"token\",response.data.token);axios.defaults.headers.common[\"Authorization\"]=\"Bearer \".concat(response.data.token);setUser(response.data.user);window.location.hash=\"\";window.history.replaceState(null,null,\" \");}catch(error){console.error(\"Google auth failed:\",error);}finally{setLoading(false);}};const handleLogin=(token,userData)=>{localStorage.setItem(\"token\",token);axios.defaults.headers.common[\"Authorization\"]=\"Bearer \".concat(token);setUser(userData);};const handleLogout=()=>{localStorage.removeItem(\"token\");delete axios.defaults.headers.common[\"Authorization\"];setUser(null);};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-gradient-to-br from-emerald-50 via-blue-50 to-purple-50\",\"x-file-name\":\"App\",\"x-line-number\":\"79\",\"x-component\":\"div\",\"x-id\":\"App_79\",\"x-dynamic\":\"false\",children:/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-16 w-16 border-t-4 border-emerald-600\",\"x-file-name\":\"App\",\"x-line-number\":\"80\",\"x-component\":\"div\",\"x-id\":\"App_80\",\"x-dynamic\":\"false\"})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"App\",\"x-file-name\":\"App\",\"x-line-number\":\"86\",\"x-component\":\"div\",\"x-id\":\"App_86\",\"x-dynamic\":\"false\",children:[/*#__PURE__*/_jsx(\"div\",{\"x-file-name\":\"App\",\"x-line-number\":\"87\",\"x-component\":\"Toaster\",\"x-id\":\"App_87\",\"x-dynamic\":\"false\",\"data-debug-wrapper\":\"true\",style:{display:\"contents\"},children:/*#__PURE__*/_jsx(Toaster,{position:\"top-right\",richColors:true})}),/*#__PURE__*/_jsx(\"div\",{\"x-file-name\":\"App\",\"x-line-number\":\"88\",\"x-component\":\"BrowserRouter\",\"x-id\":\"App_88\",\"x-dynamic\":\"false\",\"data-debug-wrapper\":\"true\",style:{display:\"contents\"},children:/*#__PURE__*/_jsx(BrowserRouter,{children:/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",element:user?user.role===\"admin\"?/*#__PURE__*/_jsx(Navigate,{to:\"/admin\"}):/*#__PURE__*/_jsx(Navigate,{to:\"/dashboard\"}):/*#__PURE__*/_jsx(Landing,{onLogin:handleLogin,\"x-file-name\":\"App\",\"x-line-number\":\"100\",\"x-component\":\"Landing\",\"x-id\":\"App_100\",\"x-dynamic\":\"true\",\"x-excluded\":\"true\"})}),/*#__PURE__*/_jsx(Route,{path:\"/dashboard\",element:user&&user.role===\"user\"?/*#__PURE__*/_jsx(UserDashboard,{user:user,onLogout:handleLogout,\"x-file-name\":\"App\",\"x-line-number\":\"108\",\"x-component\":\"UserDashboard\",\"x-id\":\"App_108\",\"x-dynamic\":\"true\",\"x-excluded\":\"true\"}):/*#__PURE__*/_jsx(Navigate,{to:\"/\"})}),/*#__PURE__*/_jsx(Route,{path:\"/admin\",element:user&&user.role===\"admin\"?/*#__PURE__*/_jsx(AdminDashboard,{user:user,onLogout:handleLogout,\"x-file-name\":\"App\",\"x-line-number\":\"118\",\"x-component\":\"AdminDashboard\",\"x-id\":\"App_118\",\"x-dynamic\":\"true\",\"x-excluded\":\"true\"}):/*#__PURE__*/_jsx(Navigate,{to:\"/\"})})]})})})]});}export default App;","map":{"version":3,"names":["useState","useEffect","BrowserRouter","Routes","Route","Navigate","axios","Landing","UserDashboard","AdminDashboard","Toaster","jsx","_jsx","jsxs","_jsxs","BACKEND_URL","process","env","REACT_APP_BACKEND_URL","API","concat","App","user","setUser","loading","setLoading","token","localStorage","getItem","defaults","headers","common","fetchUser","hash","window","location","includes","sessionId","split","processGoogleSession","response","get","data","error","removeItem","post","session_id","setItem","history","replaceState","console","handleLogin","userData","handleLogout","className","children","style","display","position","richColors","path","element","role","to","onLogin","onLogout"],"sources":["/app/frontend/src/App.js"],"sourcesContent":["import { useState, useEffect } from \"react\";\nimport \"@/App.css\";\nimport { BrowserRouter, Routes, Route, Navigate } from \"react-router-dom\";\nimport axios from \"axios\";\nimport Landing from \"./pages/Landing\";\nimport UserDashboard from \"./pages/UserDashboard\";\nimport AdminDashboard from \"./pages/AdminDashboard\";\nimport { Toaster } from \"sonner\";\n\nconst BACKEND_URL = process.env.REACT_APP_BACKEND_URL;\nexport const API = `${BACKEND_URL}/api`;\n\nfunction App() {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    // Check for existing token\n    const token = localStorage.getItem(\"token\");\n    if (token) {\n      axios.defaults.headers.common[\"Authorization\"] = `Bearer ${token}`;\n      fetchUser();\n    } else {\n      setLoading(false);\n    }\n\n    // Check for Google OAuth session_id in URL\n    const hash = window.location.hash;\n    if (hash.includes(\"session_id\")) {\n      const sessionId = hash.split(\"session_id=\")[1];\n      processGoogleSession(sessionId);\n    }\n  }, []);\n\n  const fetchUser = async () => {\n    try {\n      const response = await axios.get(`${API}/auth/me`);\n      setUser(response.data);\n    } catch (error) {\n      localStorage.removeItem(\"token\");\n      delete axios.defaults.headers.common[\"Authorization\"];\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const processGoogleSession = async (sessionId) => {\n    setLoading(true);\n    try {\n      const response = await axios.post(`${API}/auth/google-session`, {\n        session_id: sessionId,\n      });\n      localStorage.setItem(\"token\", response.data.token);\n      axios.defaults.headers.common[\"Authorization\"] = `Bearer ${response.data.token}`;\n      setUser(response.data.user);\n      window.location.hash = \"\";\n      window.history.replaceState(null, null, \" \");\n    } catch (error) {\n      console.error(\"Google auth failed:\", error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleLogin = (token, userData) => {\n    localStorage.setItem(\"token\", token);\n    axios.defaults.headers.common[\"Authorization\"] = `Bearer ${token}`;\n    setUser(userData);\n  };\n\n  const handleLogout = () => {\n    localStorage.removeItem(\"token\");\n    delete axios.defaults.headers.common[\"Authorization\"];\n    setUser(null);\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-emerald-50 via-blue-50 to-purple-50\">\n        <div className=\"animate-spin rounded-full h-16 w-16 border-t-4 border-emerald-600\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"App\">\n      <Toaster position=\"top-right\" richColors />\n      <BrowserRouter>\n        <Routes>\n          <Route\n            path=\"/\"\n            element={\n              user ? (\n                user.role === \"admin\" ? (\n                  <Navigate to=\"/admin\" />\n                ) : (\n                  <Navigate to=\"/dashboard\" />\n                )\n              ) : (\n                <Landing onLogin={handleLogin} />\n              )\n            }\n          />\n          <Route\n            path=\"/dashboard\"\n            element={\n              user && user.role === \"user\" ? (\n                <UserDashboard user={user} onLogout={handleLogout} />\n              ) : (\n                <Navigate to=\"/\" />\n              )\n            }\n          />\n          <Route\n            path=\"/admin\"\n            element={\n              user && user.role === \"admin\" ? (\n                <AdminDashboard user={user} onLogout={handleLogout} />\n              ) : (\n                <Navigate to=\"/\" />\n              )\n            }\n          />\n        </Routes>\n      </BrowserRouter>\n    </div>\n  );\n}\n\nexport default App;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}